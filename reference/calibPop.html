<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Calibration of 0/1 weights by Simulated Annealing — calibPop • simPop</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Calibration of 0/1 weights by Simulated Annealing — calibPop"><meta property="og:description" content="A Simulated Annealing Algorithm for calibration of synthetic population data
available in a simPopObj-object. The aims is to find,
given a population, a combination of different households which optimally
satisfy, in the sense of an acceptable error, a given table of specific
known marginals. The known marginals are also already available in slot
'table' of the input object 'inp'."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">simPop</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.1.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/statistikat/simPop/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Calibration of 0/1 weights by Simulated Annealing</h1>
    <small class="dont-index">Source: <a href="https://github.com/statistikat/simPop/blob/HEAD/R/calibPop.R" class="external-link"><code>R/calibPop.R</code></a></small>
    <div class="hidden name"><code>calibPop.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>A Simulated Annealing Algorithm for calibration of synthetic population data
available in a <code><a href="simPopObj-class.html">simPopObj</a></code>-object. The aims is to find,
given a population, a combination of different households which optimally
satisfy, in the sense of an acceptable error, a given table of specific
known marginals. The known marginals are also already available in slot
'table' of the input object 'inp'.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">calibPop</span><span class="op">(</span></span>
<span>  <span class="va">inp</span>,</span>
<span>  split <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  splitUpper <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  temp <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  epsP.factor <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  epsH.factor <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  epsMinN <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  maxiter <span class="op">=</span> <span class="fl">200</span>,</span>
<span>  temp.cooldown <span class="op">=</span> <span class="fl">0.9</span>,</span>
<span>  factor.cooldown <span class="op">=</span> <span class="fl">0.85</span>,</span>
<span>  min.temp <span class="op">=</span> <span class="fl">10</span><span class="op">^</span><span class="op">-</span><span class="fl">3</span>,</span>
<span>  nr_cpus <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  sizefactor <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  choose.temp <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  choose.temp.factor <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>  scale.redraw <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  observe.times <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  observe.break <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  n.forceCooldown <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  hhTables <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  persTables <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  redist.var <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  redist.var.factor <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>inp</dt>
<dd><p>an object of class <code><a href="simPopObj-class.html">simPopObj</a></code> with slot
'table' being non-null! (see <code><a href="addKnownMargins.html">addKnownMargins</a></code>).</p></dd>


<dt>split</dt>
<dd><p>given strata in which the problem will be split. Has to
correspond to a column population data (slot 'pop' of input argument 'inp')
. For example <code>split = (c("region")</code>, problem will be split for
different regions. Parallel computing is performed automatically, if
possible.</p></dd>


<dt>splitUpper</dt>
<dd><p>optional column in the population for which decides the part
of the population from which to sample for each entry in <code>split</code>.
Has to correspond to a column population data (slot 'pop' of input argument 'inp').
For example <code>split = c("region"), splitUpper = c("Country")</code>
all units from the country are eligable for donor sample when problem is split
into regions. Is usefull if <code><a href="simInitSpatial.html">simInitSpatial()</a></code> was used and the variable to split
the problem into results in very small groups (~couple of hundreds to thousands).</p></dd>


<dt>temp</dt>
<dd><p>starting temperatur for simulated annealing algorithm</p></dd>


<dt>epsP.factor</dt>
<dd><p>a factor (between 0 and 1) specifying the acceptance
error for contingency table on individual level. For example epsP.factor = 0.05 results in an acceptance error for the
objective function of <code>0.05*sum(People)</code>.</p></dd>


<dt>epsH.factor</dt>
<dd><p>a factor (between 0 and 1) specifying the acceptance
error for contingency table on household level. For example epsH.factor = 0.05 results in an acceptance error for the
objective function of <code>0.05*sum(Households)</code>.</p></dd>


<dt>epsMinN</dt>
<dd><p>integer specifying the minimum number of units from which the synthetic populatin can deviate from cells in contingency tables.
This overwrites <code>epsP.factor</code> and <code>epsH.factor</code>. Is especially usefull if cells in <code>hhTables</code> and <code>persTables</code> are very small, e.g. &lt;10.</p></dd>


<dt>maxiter</dt>
<dd><p>maximum iterations during a temperature step.</p></dd>


<dt>temp.cooldown</dt>
<dd><p>a factor (between 0 and 1) specifying the rate at which
temperature will be reduced in each step.</p></dd>


<dt>factor.cooldown</dt>
<dd><p>a factor (between 0 and 1) specifying the rate at
which the number of permutations of housholds, in each iteration, will be
reduced in each step.</p></dd>


<dt>min.temp</dt>
<dd><p>minimal temperature at which the algorithm will stop.</p></dd>


<dt>nr_cpus</dt>
<dd><p>if specified, an integer number defining the number of cpus
that should be used for parallel processing.</p></dd>


<dt>sizefactor</dt>
<dd><p>the factor for inflating the population before applying 0/1 weights</p></dd>


<dt>choose.temp</dt>
<dd><p>if TRUE <code>temp</code> will be rescaled according to <code>eps</code> and <code>choose.temp.factor</code>. <code>eps</code> is defined by the product between <code>epsP.factor</code> and <code>epsP.factor</code> with the sum over the target population margins supplied by <code><a href="addKnownMargins.html">addKnownMargins</a></code> or <code>hhTables</code> and <code>persTables</code>.</p></dd>


<dt>choose.temp.factor</dt>
<dd><p>number between (0,1) for rescaling <code>temp</code> for simulated annealing. <code>temp</code> redefined by<code>max(temp,eps*choose.temp.factor)</code>.
Can be usefull if simulated annealing is split into subgroups with considerably different population sizes. Only used if <code>choose.temp=TRUE</code>.</p></dd>


<dt>scale.redraw</dt>
<dd><p>Number between (0,1) scaling the number of households that need to be drawn and discarded in each iteration step.
The number of individuals currently selected through simulated annealing is substracted from the sum over the target population margins added to <code>inp</code> via <code>addKnownMargins</code>.
This difference is divided by the median household size resulting in an estimated number of housholds that the current synthetic population differs from the population margins (~<code>redraw_gap</code>).
The next iteration will then adjust the number of housholds to be drawn or discarded (<code>redraw</code>) according to <code>max(ceiling(redraw-redraw_gap*scale.redraw),1)</code> or <code>max(ceiling(redraw+redraw_gap*scale.redraw),1)</code> respectively.
This keeps the number of individuals in the synthetic population relatively stable regarding the population margins. Otherwise the synthetic population might be considerably larger or smaller then the population margins, through selection of many large or small households.</p></dd>


<dt>observe.times</dt>
<dd><p>Number of times the new value of the objective function is saved. If <code>observe.times=0</code> values are not saved.</p></dd>


<dt>observe.break</dt>
<dd><p>When objective value has been saved <code>observe.times</code>-times the coefficient of variation is calculated over saved values; if the coefficient of variation falls below <code>observe.break</code>
simmulated annealing terminates. This repeats for each new set of <code>observe.times</code> new values of the objecive function. Can help save run time if objective value does not improve much. Disable this termination by either setting <code>observe.times=0</code> or <code>observe.break=0</code>.</p></dd>


<dt>n.forceCooldown</dt>
<dd><p>integer, if the solution does not move for <code>n.forceCooldown</code> iterations then a cooldown is automatically done.</p></dd>


<dt>verbose</dt>
<dd><p>boolean variable; if TRUE some additional verbose output is
provided, however only if <code>split</code> is NULL. Otherwise the computation is
performed in parallel and no useful output can be provided.</p></dd>


<dt>hhTables</dt>
<dd><p>Information on population margins for households. Can bei either a single <code>data.table</code> or <code>data.frame</code> or a list with multiple <code>data.tables</code>s or <code>data.frame</code>s.
Each table must have one column named <code>Freq</code> and all other columns holding variable(s) of the synthetic population. Each row in this table corresponds to a the frequency count a one of the variable combination in that table, see examples.</p></dd>


<dt>persTables</dt>
<dd><p>Information on population margins for persons. Can bei either a single <code>data.table</code> or <code>data.frame</code> or a list with multiple <code>data.tables</code>s or <code>data.frame</code>s.
Each table must have one column named <code>Freq</code> and all other columns holding variable(s) of the synthetic population. Each row in this table corresponds to a the frequency count a one of the variable combination in that table, see examples.</p></dd>


<dt>redist.var</dt>
<dd><p>single column in the population which can be redistributed in each `split`. Still experimental!</p></dd>


<dt>redist.var.factor</dt>
<dd><p>numeric in the interval (0,1]. Used in combinationo with `redist.var`, still experimental!</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>Returns an object of class <code><a href="simPopObj-class.html">simPopObj</a></code> with an
updated population listed in slot 'pop'.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>Calibrates data using simulated annealing. The algorithm searches for a
(near) optimal combination of different households, by swaping housholds at
random in each iteration of each temperature level. During the algorithm as
well as for the output the optimal (or so far best) combination will be
indicated by a logical vector containg only 0s (not inculded) and 1s
(included in optimal selection). The objective function for simulated
annealing is defined by the sum of absolute differences between target
marginals and synthetic marginals (=marginals of synthetic dataset). The sum
of target marginals can at most be as large as the sum of target marginals.
For every factor-level in “split”, data must at least contain as many
entries of this kind as target marginals.</p>
<p>Possible donors are automatically generated within the procedure.</p>
<p>The number of cpus are selected automatically in the following manner. The
number of cpus is equal the number of strata. However, if the number of cpus
is less than the number of strata, the number of cpus - 1 is used by
default.  This should be the best strategy, but the user can also overwrite
this decision.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>M. Templ, B. Meindl, A. Kowarik, A. Alfons, O. Dupriez (2017) Simulation of Synthetic Populations for Survey Data Considering Auxiliary
Information. <em>Journal of Statistical Survey</em>, <strong>79</strong> (10), 1--38. <a href="https://doi.org/10.18637/jss.v079.i10" class="external-link">doi:10.18637/jss.v079.i10</a></p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Bernhard Meindl, Johannes Gussenbauer and Matthias Templ</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">eusilcS</span><span class="op">)</span> <span class="co"># load sample data</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">eusilcP</span><span class="op">)</span> <span class="co"># population data</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="va">inp</span> <span class="op">&lt;-</span> <span class="fu"><a href="specifyInput.html">specifyInput</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">eusilcS</span>, hhid<span class="op">=</span><span class="st">"db030"</span>, hhsize<span class="op">=</span><span class="st">"hsize"</span>, strata<span class="op">=</span><span class="st">"db040"</span>, weight<span class="op">=</span><span class="st">"db090"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">simPop</span> <span class="op">&lt;-</span> <span class="fu"><a href="simStructure.html">simStructure</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">inp</span>, method<span class="op">=</span><span class="st">"direct"</span>, basicHHvars<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"rb090"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">simPop</span> <span class="op">&lt;-</span> <span class="fu"><a href="simCategorical.html">simCategorical</a></span><span class="op">(</span><span class="va">simPop</span>, additional<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pl030"</span>, <span class="st">"pb220a"</span><span class="op">)</span>, method<span class="op">=</span><span class="st">"multinom"</span>, nr_cpus<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># add margins</span></span></span>
<span class="r-in"><span><span class="va">margins</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html" class="external-link">xtabs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">eusilcP</span><span class="op">)</span><span class="op">)</span> <span class="op">~</span> <span class="va">eusilcP</span><span class="op">$</span><span class="va">region</span> <span class="op">+</span> <span class="va">eusilcP</span><span class="op">$</span><span class="va">gender</span> <span class="op">+</span> <span class="va">eusilcP</span><span class="op">$</span><span class="va">citizenship</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">margins</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"db040"</span>, <span class="st">"rb090"</span>, <span class="st">"pb220a"</span>, <span class="st">"freq"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">simPop</span> <span class="op">&lt;-</span> <span class="fu"><a href="addKnownMargins.html">addKnownMargins</a></span><span class="op">(</span><span class="va">simPop</span>, <span class="va">margins</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">simPop_adj2</span> <span class="op">&lt;-</span> <span class="fu">calibPop</span><span class="op">(</span><span class="va">simPop</span>, split<span class="op">=</span><span class="st">"db040"</span>, </span></span>
<span class="r-in"><span>  temp<span class="op">=</span><span class="fl">1</span>, epsP.factor<span class="op">=</span><span class="fl">0.1</span>,</span></span>
<span class="r-in"><span> epsMinN<span class="op">=</span><span class="fl">10</span>, nr_cpus <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="co"># apply simulated annealing</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="va">simPop_adj</span> <span class="op">&lt;-</span> <span class="fu">calibPop</span><span class="op">(</span><span class="va">simPop</span>, split<span class="op">=</span><span class="st">"db040"</span>, temp<span class="op">=</span><span class="fl">1</span>,</span></span>
<span class="r-in"><span>epsP.factor<span class="op">=</span><span class="fl">0.1</span>,nr_cpus <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co">### use multiple different margins</span></span></span>
<span class="r-in"><span><span class="co"># person margins</span></span></span>
<span class="r-in"><span><span class="va">persTables</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html" class="external-link">xtabs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">eusilcP</span><span class="op">)</span><span class="op">)</span> <span class="op">~</span> <span class="va">eusilcP</span><span class="op">$</span><span class="va">region</span> <span class="op">+</span> <span class="va">eusilcP</span><span class="op">$</span><span class="va">gender</span> <span class="op">+</span> <span class="va">eusilcP</span><span class="op">$</span><span class="va">citizenship</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">persTables</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"db040"</span>, <span class="st">"rb090"</span>, <span class="st">"pb220a"</span>, <span class="st">"Freq"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># household margins</span></span></span>
<span class="r-in"><span><span class="va">filter_hid</span> <span class="op">&lt;-</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">eusilcP</span><span class="op">$</span><span class="va">hid</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">eusilcP</span><span class="op">$</span><span class="va">hsize4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">eusilcP</span><span class="op">$</span><span class="va">hsize</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">hhTables</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html" class="external-link">xtabs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">filter_hid</span><span class="op">)</span><span class="op">)</span> <span class="op">~</span> <span class="va">eusilcP</span><span class="op">[</span><span class="va">filter_hid</span>,<span class="op">]</span><span class="op">$</span><span class="va">region</span><span class="op">+</span><span class="va">eusilcP</span><span class="op">[</span><span class="va">filter_hid</span>,<span class="op">]</span><span class="op">$</span><span class="va">hsize4</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">hhTables</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"db040"</span>, <span class="st">"hsize4"</span>, <span class="st">"Freq"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">simPop</span><span class="op">@</span><span class="va">pop</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">hsize4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">simPop</span><span class="op">@</span><span class="va">pop</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">hsize</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">simPop_adj_2</span> <span class="op">&lt;-</span> <span class="fu">calibPop</span><span class="op">(</span><span class="va">simPop</span>, split<span class="op">=</span><span class="st">"db040"</span>, </span></span>
<span class="r-in"><span>                         temp<span class="op">=</span><span class="fl">1</span>, epsP.factor<span class="op">=</span><span class="fl">0.1</span>,</span></span>
<span class="r-in"><span>                         epsH.factor <span class="op">=</span> <span class="fl">0.1</span>,</span></span>
<span class="r-in"><span>                         persTables <span class="op">=</span> <span class="va">persTables</span>,</span></span>
<span class="r-in"><span>                         hhTables <span class="op">=</span> <span class="va">hhTables</span>,</span></span>
<span class="r-in"><span>                         nr_cpus <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Matthias Templ, Alexander Kowarik, Bernhard Meindl, Andreas Alfons.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

