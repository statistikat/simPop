<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Correct  age heaping — correctHeaps • simPop</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Correct  age heaping — correctHeaps"><meta property="og:description" content="Correct for age heaping using truncated (log-)normal distributions"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">simPop</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.1.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/statistikat/simPop/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Correct  age heaping</h1>
    <small class="dont-index">Source: <a href="https://github.com/statistikat/simPop/blob/HEAD/R/correctHeap.R" class="external-link"><code>R/correctHeap.R</code></a></small>
    <div class="hidden name"><code>correctHeaps.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Correct for age heaping using truncated (log-)normal distributions</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">correctHeaps</span><span class="op">(</span><span class="va">x</span>, heaps <span class="op">=</span> <span class="st">"10year"</span>, method <span class="op">=</span> <span class="st">"lnorm"</span>, start <span class="op">=</span> <span class="fl">0</span>, fixed <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>x</dt>
<dd><p>numeric vector</p></dd>


<dt>heaps</dt>
<dd><ul><li><p><code>5year</code>: heaps are assumed to be every 5 years (0,5,10,...)</p></li>
<li><p><code>10year</code>: heaps are assumed to be every 10 years (0,10,20,...)</p></li>
</ul></dd>


<dt>method</dt>
<dd><p>a character specifying the algorithm used to correct the age
heaps. Allowed values are</p><ul><li><p><code>lnorm</code>: drawing from a truncated log-normal distribution. The
required parameters are estimated using original input data.</p></li>
<li><p><code>norm</code>: drawing from a truncated normal distribution. The
required parameters are estimated using original input data.</p></li>
<li><p><code>unif</code>: random sampling from a (truncated) uniform distribution</p></li>
</ul></dd>


<dt>start</dt>
<dd><p>a numeric value for the starting of the 5 or 10 year sequences
(e.g. 0, 5 or 10)</p></dd>


<dt>fixed</dt>
<dd><p>numeric index vector with observation that should not be changed</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>a numeric vector without age heaps</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>Age heaping can cause substantial bias
in important measures and thus age heaping should be corrected.</p>
<p>For method “lnorm”, a truncated log-normal is fit to the whole age distribution. 
Then for each age heap (at 0, 5, 10, 15, ...) random numbers of a truncated 
log-normal (with lower and upper bound) is drawn in the 
interval +- 2 around the heap (rounding of degree 2) 
using the inverse transformation method. A ratio of randomly 
chosen observations on an age heap are replaced 
by these random draws. For the ratio the age distribution is chosen, whereas 
on an age heap (e.g. 5)
the arithmetic means of the two neighboring ages are calculated 
(average counts on age 4 and age 6 for age heap equals 5, for example).
The ratio on, e.g. age equals 5 is then given by the count on age 5 divided by this mean
This is done for any age heap at (0, 5, 10, 15, ...).</p>
<p>Method “norm” replace the draws from truncated log-normals to draws from 
truncated normals. It depends on the age distrubution (if right-skewed or not) if method
“lnorm” or “norm” should be used. Many distributions with heaping problems
are right-skewed.</p>
<p>Method “unif” draws the mentioned ratio of observations on truncated uniform distributions
around the age heaps.</p>
<p>Repeated calls of this function mimics multiple imputation, i.e. repeating this 
procedure m times provides m imputed datasets that properly reflect the 
uncertainty from imputation.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>M. Templ, B. Meindl, A. Kowarik, A. Alfons, O. Dupriez (2017) Simulation of Synthetic Populations for Survey Data Considering Auxiliary
Information. <em>Journal of Statistical Survey</em>, <strong>79</strong> (10), 1--38. doi: 10.18637/jss.v079.i10</p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Matthias Templ, Bernhard Meindl, Alexander Kowarik</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## create some artificial data</span></span></span>
<span class="r-in"><span><span class="va">age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">rlnorm</a></span><span class="op">(</span><span class="fl">10000</span>, meanlog<span class="op">=</span><span class="fl">2.466869</span>, sdlog<span class="op">=</span><span class="fl">1.652772</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">age</span><span class="op">[</span><span class="va">age</span> <span class="op">&lt;</span> <span class="fl">93</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html" class="external-link">barplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="correctHeaps-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## artificially introduce age heaping and correct it:</span></span></span>
<span class="r-in"><span><span class="co"># heaps every 5 years</span></span></span>
<span class="r-in"><span><span class="va">year5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span>, <span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">age5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">age</span>, <span class="va">age</span><span class="op">[</span><span class="va">age</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">year5</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">cc5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"darkgrey"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">cc5</span><span class="op">[</span><span class="va">year5</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"yellow"</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html" class="external-link">barplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">age5</span><span class="op">)</span>, col<span class="op">=</span><span class="va">cc5</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="correctHeaps-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html" class="external-link">barplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu">correctHeaps</span><span class="op">(</span><span class="va">age5</span>, heaps<span class="op">=</span><span class="st">"5year"</span>, method<span class="op">=</span><span class="st">"lnorm"</span><span class="op">)</span><span class="op">)</span>, col<span class="op">=</span><span class="va">cc5</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="correctHeaps-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># heaps every 10 years</span></span></span>
<span class="r-in"><span><span class="va">year10</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">age10</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">age</span>, <span class="va">age</span><span class="op">[</span><span class="va">age</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">year10</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">cc10</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"darkgrey"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">cc10</span><span class="op">[</span><span class="va">year10</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"yellow"</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html" class="external-link">barplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">age10</span><span class="op">)</span>, col<span class="op">=</span><span class="va">cc10</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="correctHeaps-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html" class="external-link">barplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu">correctHeaps</span><span class="op">(</span><span class="va">age10</span>, heaps<span class="op">=</span><span class="st">"10year"</span>, method<span class="op">=</span><span class="st">"lnorm"</span><span class="op">)</span><span class="op">)</span>, col<span class="op">=</span><span class="va">cc10</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="correctHeaps-5.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># the first 5 observations should be unchanged</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html" class="external-link">barplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu">correctHeaps</span><span class="op">(</span><span class="va">age10</span>, heaps<span class="op">=</span><span class="st">"10year"</span>, method<span class="op">=</span><span class="st">"lnorm"</span>, fixed<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span>, col<span class="op">=</span><span class="va">cc10</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="correctHeaps-6.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Matthias Templ, Alexander Kowarik, Bernhard Meindl, Andreas Alfons.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

