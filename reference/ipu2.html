<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Iterative Proportional Updating — ipu2 • simPop</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Iterative Proportional Updating — ipu2"><meta property="og:description" content="Adjust sampling weights to given totals based on household-level and/or
individual level constraints."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">simPop</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/statistikat/simPop/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Iterative Proportional Updating</h1>
    <small class="dont-index">Source: <a href="https://github.com/statistikat/simPop/blob/HEAD/R/ipu2.r" class="external-link"><code>R/ipu2.r</code></a></small>
    <div class="hidden name"><code>ipu2.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Adjust sampling weights to given totals based on household-level and/or
individual level constraints.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">ipu2</span><span class="op">(</span>
  <span class="va">dat</span>,
  hid <span class="op">=</span> <span class="cn">NULL</span>,
  conP <span class="op">=</span> <span class="cn">NULL</span>,
  conH <span class="op">=</span> <span class="cn">NULL</span>,
  epsP <span class="op">=</span> <span class="fl">1e-06</span>,
  epsH <span class="op">=</span> <span class="fl">0.01</span>,
  verbose <span class="op">=</span> <span class="cn">FALSE</span>,
  w <span class="op">=</span> <span class="cn">NULL</span>,
  bound <span class="op">=</span> <span class="fl">4</span>,
  maxIter <span class="op">=</span> <span class="fl">200</span>,
  meanHH <span class="op">=</span> <span class="cn">TRUE</span>,
  allPthenH <span class="op">=</span> <span class="cn">TRUE</span>,
  returnNA <span class="op">=</span> <span class="cn">TRUE</span>,
  looseH <span class="op">=</span> <span class="cn">FALSE</span>,
  numericalWeighting <span class="op">=</span> <span class="cn">NULL</span>,
  check_hh_vars <span class="op">=</span> <span class="cn">TRUE</span>,
  conversion_messages <span class="op">=</span> <span class="cn">FALSE</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>dat</dt>
<dd><p>a <code>data.table</code> containing household ids (optionally), base
weights (optionally), household and/or personal level variables (numerical
or categorical) that should be fitted.</p></dd>


<dt>hid</dt>
<dd><p>name of the column containing the household-ids
within <code>dat</code> or NULL if such a variable does not exist.</p></dd>


<dt>conP</dt>
<dd><p>list or (partly) named list defining the constraints on person
level.  The list elements are contingency tables in array representation
with dimnames corresponding to the names of the relevant calibration
variables in <code>dat</code>. If a numerical variable is to be calibrated, the
respective list element has to be named with the name of that numerical
variable. Otherwise the list element shoud NOT be named.</p></dd>


<dt>conH</dt>
<dd><p>list or (partly) named list defining the constraints on
household level.  The list elements are contingency tables in array
representation with dimnames corresponding to the names of the relevant
calibration variables in <code>dat</code>. If a numerical variable is to be
calibrated, the respective list element has to be named with the name of
that numerical variable. Otherwise the list element shoud NOT be named.</p></dd>


<dt>epsP</dt>
<dd><p>numeric value or list (of numeric values and/or arrays)
specifying the convergence limit(s) for <code>conP</code>. The list can contain
numeric values and/or arrays which must appear in the same order as the
corresponding constraints in <code>conP</code>. Also, an array must have the same
dimensions and dimnames as the corresponding constraint in <code>conP</code>.</p></dd>


<dt>epsH</dt>
<dd><p>numeric value or list (of numeric values and/or arrays)
specifying the convergence limit(s) for <code>conH</code>. The list can contain
numeric values and/or arrays which must appear in the same order as the
corresponding constraints in <code>conH</code>. Also, an array must have the same
dimensions and dimnames as the corresponding constraint in <code>conH</code>.</p></dd>


<dt>verbose</dt>
<dd><p>if TRUE, some progress information will be printed.</p></dd>


<dt>w</dt>
<dd><p>name if the column containing the base
weights within <code>dat</code> or NULL if such a variable does not exist. In the
latter case, every observation in <code>dat</code> is assigned a starting weight
of 1.</p></dd>


<dt>bound</dt>
<dd><p>numeric value specifying the multiplier for determining the
weight trimming boundary if the change of the base weights should be
restricted, i.e. if the weights should stay between 1/<code>bound</code>*<code>w</code>
and <code>bound</code>*<code>w</code>.</p></dd>


<dt>maxIter</dt>
<dd><p>numeric value specifying the maximum number of iterations
that should be performed.</p></dd>


<dt>meanHH</dt>
<dd><p>if TRUE, every person in a household is assigned the mean of
the person weights corresponding to the household. If <code>"geometric"</code>, the geometric mean
is used rather than the arithmetic mean.</p></dd>


<dt>allPthenH</dt>
<dd><p>if TRUE, all the person level calibration steps are performed before the houshold level calibration steps (and <code>meanHH</code>, if specified).
If FALSE, the houshold level calibration steps (and <code>meanHH</code>, if specified) are performed after everey person level calibration step.
This can lead to better convergence properties in certain cases but also means that the total number of calibration steps is increased.</p></dd>


<dt>returnNA</dt>
<dd><p>if TRUE, the calibrated weight will be set to NA in case of no convergence.</p></dd>


<dt>looseH</dt>
<dd><p>if FALSE, the actual constraints <code>conH</code> are used for calibrating all the hh weights.
If TRUE, only the weights for which the lower and upper thresholds defined by <code>conH</code> and <code>epsH</code> are exceeded
are calibrated. They are however not calibrated against the actual constraints <code>conH</code> but against
these lower and upper thresholds, i.e. <code>conH</code>-<code>conH</code>*<code>epsH</code> and <code>conH</code>+<code>conH</code>*<code>epsH</code>.</p></dd>


<dt>numericalWeighting</dt>
<dd><p>If NULL computeLinear from the pacakge survey sd will be used.</p></dd>


<dt>check_hh_vars</dt>
<dd><p>If <code>TRUE</code> check for non-unique values inside of a household for variables in
household constraints</p></dd>


<dt>conversion_messages</dt>
<dd><p>show a message, if inputs need to be reformatted. This can be useful for speed
optimizations if ipu2 is called several times with similar inputs (for example bootstrapping)</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>The function will return the input data <code>dat</code> with the
calibrated weights <code>calibWeight</code> as an additional column as well as attributes. If no convergence has been reached in <code>maxIter</code></p>


<p>steps, and <code>returnNA</code> is <code>TRUE</code> (the default), the column <code>calibWeights</code> will only consist of <code>NA</code>s. The attributes of the table are
attributes derived from the <code>data.table</code> class as well as the following.</p><table class="table table"><tr><td><code>converged</code></td><td>Did the algorithm converge in <code>maxIter</code> steps?</td></tr><tr><td><code>iterations</code></td><td>The number of iterations performed.</td></tr><tr><td><code>conP</code>, <code>conH</code>, <code>epsP</code>, <code>epsH</code></td><td>See Arguments.</td></tr><tr><td><code>conP_adj</code>, <code>conH_adj</code></td><td>Adjusted versions of <code>conP</code> and <code>conH</code></td></tr><tr><td><code>formP</code>, <code>formH</code></td><td>Formulas that were used to calculate <code>conP_adj</code> and <code>conH_adj</code> based on the output table.</td></tr></table></div>
    <div id="details">
    <h2>Details</h2>
    <p>This function implements the weighting procedure described
<a href="https://www.ajs.or.at/index.php/ajs/article/download/doi10.17713ajs.v45i3.120/512/0" class="external-link">here</a>.</p>
<p><code>conP</code> and <code>conH</code> are contingency tables, which can be created with <code>xtabs</code>. The <code>dimnames</code> of those
tables should match the names and levels of the corresponding columns in <code>dat</code>.</p>
<p><code>maxIter</code>, <code>epsP</code> and <code>epsH</code> are the stopping criteria. <code>epsP</code> and <code>epsH</code> describe relative tolerances
in the sense that
\deqn{1-epsP &lt; \frac{w_{i+1}}{w_i} &lt; 1+epsP}{1-epsP &lt; w(i+1)/w(i) &lt; 1+epsP} 
will be used as convergence criterium. Here i is the iteration step and wi is the weight of a
specific person at step i.</p>
<p>The algorithm
performs best if all varables occuring in the constraints (<code>conP</code> and <code>conH</code>) as well as the
household variable are coded as <code>factor</code>-columns in <code>dat</code>. Otherwise, conversions will be necessary
which can be monitored with the <code>conversion_messages</code> argument.
Setting <code>check_hh_vars</code> to <code>FALSE</code> can also incease the performance of the scheme.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="ipu.html">ipu</a></code></p></div>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Alexander Kowarik, Gregor de Cillia</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">eusilcS</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setDT.html" class="external-link">setDT</a></span><span class="op">(</span><span class="va">eusilcS</span><span class="op">)</span></span>
<span class="r-in"><span class="va">eusilcS</span> <span class="op">&lt;-</span> <span class="va">eusilcS</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">db030</span>,<span class="va">hsize</span>,<span class="va">db040</span>,<span class="va">age</span>,<span class="va">rb090</span>,<span class="va">netIncome</span>,<span class="va">db090</span>,<span class="va">rb050</span><span class="op">)</span><span class="op">]</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## rename columns</span></span>
<span class="r-in"><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setattr.html" class="external-link">setnames</a></span><span class="op">(</span><span class="va">eusilcS</span>, <span class="st">"rb090"</span>, <span class="st">"gender"</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setattr.html" class="external-link">setnames</a></span><span class="op">(</span><span class="va">eusilcS</span>, <span class="st">"db040"</span>, <span class="st">"state"</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setattr.html" class="external-link">setnames</a></span><span class="op">(</span><span class="va">eusilcS</span>, <span class="st">"db030"</span>, <span class="st">"household"</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setattr.html" class="external-link">setnames</a></span><span class="op">(</span><span class="va">eusilcS</span>, <span class="st">"rb050"</span>, <span class="st">"weight"</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## some recoding</span></span>
<span class="r-in"><span class="co"># generate age groups</span></span>
<span class="r-in"><span class="va">eusilcS</span><span class="op">[</span>, <span class="va">agegroup</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="va">age</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>, <span class="fl">10</span><span class="op">*</span><span class="fl">1</span><span class="op">:</span><span class="fl">9</span>, <span class="cn">Inf</span><span class="op">)</span>, right <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">]</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        household hsize         state age gender netIncome    db090   weight</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     1:         1     2      Salzburg  72   male  22675.48 7.822929 7.822929</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     2:         1     2      Salzburg  66 female  16999.29 7.822929 7.822929</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     3:         2     1 Upper Austria  56 female  19274.21 8.788089 8.788089</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     4:         3     1        Styria  67 female  13319.13 8.108452 8.108452</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     5:         4     3 Upper Austria  70 female  14365.57 7.509383 7.509383</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    ---                                                                     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11721:      4639     2     Carinthia  60 female  11405.85 6.863162 6.863162</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11722:      4640     2     Carinthia  60   male  15476.11 6.863162 6.863162</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11723:      4640     2     Carinthia  55 female      0.00 6.863162 6.863162</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11724:      4641     2        Vienna  56   male  30367.92 8.772773 8.772773</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11725:      4641     2        Vienna  52 female   6368.93 8.772773 8.772773</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        agegroup</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     1:  [70,80)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     2:  [60,70)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     3:  [50,60)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     4:  [60,70)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     5:  [70,80)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    ---         </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11721:  [60,70)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11722:  [60,70)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11723:  [50,60)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11724:  [50,60)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11725:  [50,60)</span>
<span class="r-in"><span class="co"># some recoding of netIncome for reasons of simplicity</span></span>
<span class="r-in"><span class="va">eusilcS</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">netIncome</span><span class="op">)</span>, <span class="va">netIncome</span> <span class="op">:=</span> <span class="fl">0</span><span class="op">]</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        household hsize         state age gender netIncome    db090   weight</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     1:         1     2      Salzburg  72   male  22675.48 7.822929 7.822929</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     2:         1     2      Salzburg  66 female  16999.29 7.822929 7.822929</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     3:         2     1 Upper Austria  56 female  19274.21 8.788089 8.788089</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     4:         3     1        Styria  67 female  13319.13 8.108452 8.108452</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     5:         4     3 Upper Austria  70 female  14365.57 7.509383 7.509383</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    ---                                                                     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11721:      4639     2     Carinthia  60 female  11405.85 6.863162 6.863162</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11722:      4640     2     Carinthia  60   male  15476.11 6.863162 6.863162</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11723:      4640     2     Carinthia  55 female      0.00 6.863162 6.863162</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11724:      4641     2        Vienna  56   male  30367.92 8.772773 8.772773</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11725:      4641     2        Vienna  52 female   6368.93 8.772773 8.772773</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        agegroup</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     1:  [70,80)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     2:  [60,70)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     3:  [50,60)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     4:  [60,70)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     5:  [70,80)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    ---         </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11721:  [60,70)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11722:  [60,70)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11723:  [50,60)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11724:  [50,60)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11725:  [50,60)</span>
<span class="r-in"><span class="va">eusilcS</span><span class="op">[</span><span class="va">netIncome</span> <span class="op">&lt;</span> <span class="fl">0</span>, <span class="va">netIncome</span> <span class="op">:=</span> <span class="fl">0</span><span class="op">]</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        household hsize         state age gender netIncome    db090   weight</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     1:         1     2      Salzburg  72   male  22675.48 7.822929 7.822929</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     2:         1     2      Salzburg  66 female  16999.29 7.822929 7.822929</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     3:         2     1 Upper Austria  56 female  19274.21 8.788089 8.788089</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     4:         3     1        Styria  67 female  13319.13 8.108452 8.108452</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     5:         4     3 Upper Austria  70 female  14365.57 7.509383 7.509383</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    ---                                                                     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11721:      4639     2     Carinthia  60 female  11405.85 6.863162 6.863162</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11722:      4640     2     Carinthia  60   male  15476.11 6.863162 6.863162</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11723:      4640     2     Carinthia  55 female      0.00 6.863162 6.863162</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11724:      4641     2        Vienna  56   male  30367.92 8.772773 8.772773</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11725:      4641     2        Vienna  52 female   6368.93 8.772773 8.772773</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        agegroup</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     1:  [70,80)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     2:  [60,70)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     3:  [50,60)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     4:  [60,70)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     5:  [70,80)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    ---         </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11721:  [60,70)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11722:  [60,70)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11723:  [50,60)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11724:  [50,60)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11725:  [50,60)</span>
<span class="r-in"><span class="co"># set hsize to 1,...,5+</span></span>
<span class="r-in"><span class="va">eusilcS</span><span class="op">[</span>, <span class="va">hsize</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="va">hsize</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">4</span>, <span class="cn">Inf</span><span class="op">)</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="st">"5+"</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        household hsize         state age gender netIncome    db090   weight</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     1:         1     2      Salzburg  72   male  22675.48 7.822929 7.822929</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     2:         1     2      Salzburg  66 female  16999.29 7.822929 7.822929</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     3:         2     1 Upper Austria  56 female  19274.21 8.788089 8.788089</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     4:         3     1        Styria  67 female  13319.13 8.108452 8.108452</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     5:         4     3 Upper Austria  70 female  14365.57 7.509383 7.509383</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    ---                                                                     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11721:      4639     2     Carinthia  60 female  11405.85 6.863162 6.863162</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11722:      4640     2     Carinthia  60   male  15476.11 6.863162 6.863162</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11723:      4640     2     Carinthia  55 female      0.00 6.863162 6.863162</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11724:      4641     2        Vienna  56   male  30367.92 8.772773 8.772773</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11725:      4641     2        Vienna  52 female   6368.93 8.772773 8.772773</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        agegroup</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     1:  [70,80)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     2:  [60,70)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     3:  [50,60)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     4:  [60,70)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     5:  [70,80)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    ---         </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11721:  [60,70)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11722:  [60,70)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11723:  [50,60)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11724:  [50,60)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11725:  [50,60)</span>
<span class="r-in"><span class="co"># treat households as a factor variable</span></span>
<span class="r-in"><span class="va">eusilcS</span><span class="op">[</span>, <span class="va">household</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">household</span><span class="op">)</span><span class="op">]</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        household hsize         state age gender netIncome    db090   weight</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     1:         1     2      Salzburg  72   male  22675.48 7.822929 7.822929</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     2:         1     2      Salzburg  66 female  16999.29 7.822929 7.822929</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     3:         2     1 Upper Austria  56 female  19274.21 8.788089 8.788089</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     4:         3     1        Styria  67 female  13319.13 8.108452 8.108452</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     5:         4     3 Upper Austria  70 female  14365.57 7.509383 7.509383</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    ---                                                                     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11721:      4639     2     Carinthia  60 female  11405.85 6.863162 6.863162</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11722:      4640     2     Carinthia  60   male  15476.11 6.863162 6.863162</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11723:      4640     2     Carinthia  55 female      0.00 6.863162 6.863162</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11724:      4641     2        Vienna  56   male  30367.92 8.772773 8.772773</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11725:      4641     2        Vienna  52 female   6368.93 8.772773 8.772773</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        agegroup</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     1:  [70,80)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     2:  [60,70)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     3:  [50,60)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     4:  [60,70)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     5:  [70,80)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    ---         </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11721:  [60,70)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11722:  [60,70)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11723:  [50,60)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11724:  [50,60)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11725:  [50,60)</span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## example for base weights assuming a simple random sample of households stratified per region</span></span>
<span class="r-in"><span class="va">eusilcS</span><span class="op">[</span>, <span class="va">regSamp</span> <span class="op">:=</span> <span class="va">.N</span>, by <span class="op">=</span> <span class="va">state</span><span class="op">]</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        household hsize         state age gender netIncome    db090   weight</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     1:         1     2      Salzburg  72   male  22675.48 7.822929 7.822929</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     2:         1     2      Salzburg  66 female  16999.29 7.822929 7.822929</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     3:         2     1 Upper Austria  56 female  19274.21 8.788089 8.788089</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     4:         3     1        Styria  67 female  13319.13 8.108452 8.108452</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     5:         4     3 Upper Austria  70 female  14365.57 7.509383 7.509383</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    ---                                                                     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11721:      4639     2     Carinthia  60 female  11405.85 6.863162 6.863162</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11722:      4640     2     Carinthia  60   male  15476.11 6.863162 6.863162</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11723:      4640     2     Carinthia  55 female      0.00 6.863162 6.863162</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11724:      4641     2        Vienna  56   male  30367.92 8.772773 8.772773</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11725:      4641     2        Vienna  52 female   6368.93 8.772773 8.772773</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        agegroup regSamp</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     1:  [70,80)     779</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     2:  [60,70)     779</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     3:  [50,60)    2120</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     4:  [60,70)    1859</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     5:  [70,80)    2120</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    ---                 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11721:  [60,70)     927</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11722:  [60,70)     927</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11723:  [50,60)     927</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11724:  [50,60)    1789</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11725:  [50,60)    1789</span>
<span class="r-in"><span class="va">eusilcS</span><span class="op">[</span>, <span class="va">regPop</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">weight</span><span class="op">)</span>, by <span class="op">=</span> <span class="va">state</span><span class="op">]</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        household hsize         state age gender netIncome    db090   weight</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     1:         1     2      Salzburg  72   male  22675.48 7.822929 7.822929</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     2:         1     2      Salzburg  66 female  16999.29 7.822929 7.822929</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     3:         2     1 Upper Austria  56 female  19274.21 8.788089 8.788089</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     4:         3     1        Styria  67 female  13319.13 8.108452 8.108452</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     5:         4     3 Upper Austria  70 female  14365.57 7.509383 7.509383</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    ---                                                                     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11721:      4639     2     Carinthia  60 female  11405.85 6.863162 6.863162</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11722:      4640     2     Carinthia  60   male  15476.11 6.863162 6.863162</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11723:      4640     2     Carinthia  55 female      0.00 6.863162 6.863162</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11724:      4641     2        Vienna  56   male  30367.92 8.772773 8.772773</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11725:      4641     2        Vienna  52 female   6368.93 8.772773 8.772773</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        agegroup regSamp    regPop</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     1:  [70,80)     779  5344.346</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     2:  [60,70)     779  5344.346</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     3:  [50,60)    2120 14212.777</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     4:  [60,70)    1859 11668.709</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     5:  [70,80)    2120 14212.777</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    ---                           </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11721:  [60,70)     927  5637.013</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11722:  [60,70)     927  5637.013</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11723:  [50,60)     927  5637.013</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11724:  [50,60)    1789 16006.860</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11725:  [50,60)    1789 16006.860</span>
<span class="r-in"><span class="va">eusilcS</span><span class="op">[</span>, <span class="va">baseWeight</span> <span class="op">:=</span> <span class="va">regPop</span><span class="op">/</span><span class="va">regSamp</span><span class="op">]</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        household hsize         state age gender netIncome    db090   weight</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     1:         1     2      Salzburg  72   male  22675.48 7.822929 7.822929</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     2:         1     2      Salzburg  66 female  16999.29 7.822929 7.822929</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     3:         2     1 Upper Austria  56 female  19274.21 8.788089 8.788089</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     4:         3     1        Styria  67 female  13319.13 8.108452 8.108452</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     5:         4     3 Upper Austria  70 female  14365.57 7.509383 7.509383</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    ---                                                                     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11721:      4639     2     Carinthia  60 female  11405.85 6.863162 6.863162</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11722:      4640     2     Carinthia  60   male  15476.11 6.863162 6.863162</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11723:      4640     2     Carinthia  55 female      0.00 6.863162 6.863162</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11724:      4641     2        Vienna  56   male  30367.92 8.772773 8.772773</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11725:      4641     2        Vienna  52 female   6368.93 8.772773 8.772773</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        agegroup regSamp    regPop baseWeight</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     1:  [70,80)     779  5344.346   6.860522</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     2:  [60,70)     779  5344.346   6.860522</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     3:  [50,60)    2120 14212.777   6.704140</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     4:  [60,70)    1859 11668.709   6.276874</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     5:  [70,80)    2120 14212.777   6.704140</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    ---                                      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11721:  [60,70)     927  5637.013   6.080920</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11722:  [60,70)     927  5637.013   6.080920</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11723:  [50,60)     927  5637.013   6.080920</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11724:  [50,60)    1789 16006.860   8.947379</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11725:  [50,60)    1789 16006.860   8.947379</span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## constraints on person level</span></span>
<span class="r-in"><span class="co"># age </span></span>
<span class="r-in"><span class="va">conP1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html" class="external-link">xtabs</a></span><span class="op">(</span><span class="va">weight</span> <span class="op">~</span> <span class="va">agegroup</span>, data <span class="op">=</span> <span class="va">eusilcS</span><span class="op">)</span></span>
<span class="r-in"><span class="co"># gender by region</span></span>
<span class="r-in"><span class="va">conP2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html" class="external-link">xtabs</a></span><span class="op">(</span><span class="va">weight</span> <span class="op">~</span> <span class="va">gender</span> <span class="op">+</span> <span class="va">state</span>, data <span class="op">=</span> <span class="va">eusilcS</span><span class="op">)</span></span>
<span class="r-in"><span class="co"># personal net income by gender</span></span>
<span class="r-in"><span class="va">conP3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html" class="external-link">xtabs</a></span><span class="op">(</span><span class="va">weight</span><span class="op">*</span><span class="va">netIncome</span> <span class="op">~</span> <span class="va">gender</span>, data <span class="op">=</span> <span class="va">eusilcS</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## constraints on household level</span></span>
<span class="r-in"><span class="va">conH1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html" class="external-link">xtabs</a></span><span class="op">(</span><span class="va">weight</span> <span class="op">~</span> <span class="va">hsize</span> <span class="op">+</span> <span class="va">state</span>, data <span class="op">=</span> <span class="va">eusilcS</span>, subset <span class="op">=</span> <span class="op">!</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">household</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># array of convergence limits for conH1</span></span>
<span class="r-in"><span class="va">epsH1</span> <span class="op">&lt;-</span> <span class="va">conH1</span></span>
<span class="r-in"><span class="va">epsH1</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.005</span></span>
<span class="r-in"><span class="va">epsH1</span><span class="op">[</span><span class="st">"5+"</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.2</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># without array epsH1</span></span>
<span class="r-in"><span class="va">calibweights1</span> <span class="op">&lt;-</span> <span class="fu">ipu2</span><span class="op">(</span><span class="va">eusilcS</span>, hid <span class="op">=</span> <span class="st">"household"</span>, </span>
<span class="r-in">                      conP <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">conP1</span>, <span class="va">conP2</span>, netIncome <span class="op">=</span> <span class="va">conP3</span><span class="op">)</span>, </span>
<span class="r-in">                      conH <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">conH1</span><span class="op">)</span>, </span>
<span class="r-in">                      epsP <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">1e-06</span>, <span class="fl">1e-06</span>, <span class="fl">1e-03</span><span class="op">)</span>,</span>
<span class="r-in">                      epsH <span class="op">=</span> <span class="fl">0.01</span>,  </span>
<span class="r-in">                      bound <span class="op">=</span> <span class="cn">NULL</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span>,  maxIter <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>the functionality of ipu2 moved to the package surveysd in the function ipf</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 10:Not yet converged for P-Constraint1</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 10:Not yet converged for P-Constraint2</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 10:Not yet converged for P-Constraint3</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 20:Not yet converged for P-Constraint1</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 20:Not yet converged for P-Constraint2</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 30:Not yet converged for P-Constraint1</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 30:Not yet converged for P-Constraint2</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 40:Not yet converged for P-Constraint1</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 40:Not yet converged for P-Constraint2</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Iteration stopped after 43 steps</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Convergence reached</span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># with array epsH1, base weights and bound</span></span>
<span class="r-in"><span class="va">calibweights2</span> <span class="op">&lt;-</span> <span class="fu">ipu2</span><span class="op">(</span><span class="va">eusilcS</span>, hid <span class="op">=</span> <span class="st">"household"</span>, </span>
<span class="r-in">                      conP <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">conP1</span>, <span class="va">conP2</span><span class="op">)</span>, </span>
<span class="r-in">                      conH <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">conH1</span><span class="op">)</span>, </span>
<span class="r-in">                      epsP <span class="op">=</span> <span class="fl">1e-06</span>,</span>
<span class="r-in">                      epsH <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">epsH1</span><span class="op">)</span>,  </span>
<span class="r-in">                      w <span class="op">=</span> <span class="st">"baseWeight"</span>,</span>
<span class="r-in">                      bound <span class="op">=</span> <span class="fl">4</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span>, maxIter <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>the functionality of ipu2 moved to the package surveysd in the function ipf</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 10:Not yet converged for P-Constraint1</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 10:Not yet converged for P-Constraint2</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 10:Not yet converged for H-Constraint1</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 20:Not yet converged for P-Constraint1</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 20:Not yet converged for P-Constraint2</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 30:Not yet converged for P-Constraint1</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 30:Not yet converged for P-Constraint2</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 40:Not yet converged for P-Constraint1</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 40:Not yet converged for P-Constraint2</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Iteration stopped after 46 steps</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Convergence reached</span>
<span class="r-in">                      </span>
<span class="r-in"><span class="co"># show an adjusted version of conP and the original</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">calibweights2</span>, <span class="st">"conP_adj"</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[1]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> agegroup</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [-Inf,10)    [10,20)    [20,30)    [30,40)    [40,50)    [50,60)    [60,70) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  7990.8360  9830.0050  9901.6674 12100.3417 13978.4222 10999.9179  8597.5028 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    [70,80)    [80,90)  [90, Inf) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  5311.5742  2796.6133   313.1196 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[2]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         state</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> gender   Burgenland Carinthia Lower Austria Salzburg   Styria    Tyrol</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   male     1193.554  2793.544      7817.991 2645.441 5627.668 3389.482</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   female   1407.260  2843.469      7752.320 2698.905 6041.041 3623.173</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         state</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> gender   Upper Austria   Vienna Vorarlberg</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   male        6994.741 7569.677   1850.917</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   female      7218.038 8437.181   1915.598</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">calibweights2</span>, <span class="st">"conP"</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[1]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> agegroup</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [-Inf,10)    [10,20)    [20,30)    [30,40)    [40,50)    [50,60)    [60,70) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  7990.8432  9830.0105  9901.6665 12100.3345 13978.4171 10999.9180  8597.5030 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    [70,80)    [80,90)  [90, Inf) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  5311.5743  2796.6133   313.1196 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[2]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         state</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> gender   Burgenland Carinthia Lower Austria Salzburg   Styria    Tyrol</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   male     1193.555  2793.547      7817.994 2645.443 5627.671 3389.485</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   female   1407.259  2843.466      7752.317 2698.904 6041.038 3623.170</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         state</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> gender   Upper Austria   Vienna Vorarlberg</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   male        6994.744 7569.680   1850.918</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   female      7218.033 8437.181   1915.596</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Matthias Templ, Alexander Kowarik, Bernhard Meindl, Andreas Alfons.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.4.</p>
</div>

      </footer></div>

  


  

  </body></html>

